{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/adlan/multas/multas/app/api/plantillas/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport { Pool } from \"pg\";\r\nimport { writeFile, mkdir } from \"fs/promises\";\r\nimport path from \"path\";\r\n\r\nexport const runtime = \"nodejs\"; // ✅ IMPORTANTÍSIMO (para usar fs)\r\n\r\nconst pool = new Pool({\r\n  connectionString: process.env.DATABASE_URL,\r\n});\r\n\r\nexport async function GET() {\r\n  try {\r\n    const res = await pool.query(\r\n      \"SELECT * FROM plantillas_pago ORDER BY id DESC\"\r\n    );\r\n    return NextResponse.json(res.rows);\r\n  } catch (e: any) {\r\n    return NextResponse.json({ error: e.message }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(req: Request) {\r\n  try {\r\n    const form = await req.formData();\r\n\r\n    const cuentaBancaria = String(form.get(\"cuenta_bancaria\") || \"\").trim();\r\n    const subproducto = String(form.get(\"subproducto\") || \"\").trim();\r\n    const file = form.get(\"url\");\r\n\r\n    if (!cuentaBancaria || !subproducto || !(file instanceof File)) {\r\n      return NextResponse.json({ error: \"Faltan campos\" }, { status: 400 });\r\n    }\r\n\r\n    const uploadsDir = path.join(process.cwd(), \"public\", \"uploads\");\r\n    await mkdir(uploadsDir, { recursive: true });\r\n\r\n    const safeName = (file.name || \"imagen\")\r\n      .replace(/\\s+/g, \"_\")\r\n      .replace(/[^a-zA-Z0-9._-]/g, \"\");\r\n\r\n    const filename = `${Date.now()}_${safeName}`;\r\n    const filepath = path.join(uploadsDir, filename);\r\n\r\n    const buffer = Buffer.from(await file.arrayBuffer());\r\n    await writeFile(filepath, buffer);\r\n\r\n    const url = `/uploads/${filename}`;\r\n\r\n    const result = await pool.query(\r\n      `INSERT INTO plantillas_pago (cuenta_bancaria, subproducto, url)\r\n       VALUES ($1, $2, $3)\r\n       RETURNING *`,\r\n      [cuentaBancaria, subproducto, url]\r\n    );\r\n\r\n    return NextResponse.json(result.rows[0]);\r\n  } catch (e: any) {\r\n    return NextResponse.json({ error: e.message }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AACA;AACA;;;;;;;;;AAEO,MAAM,UAAU,UAAU,kCAAkC;AAEnE,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;AAC5C;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,MAAM,MAAM,KAAK,KAAK,CAC1B;QAEF,OAAO,oKAAY,CAAC,IAAI,CAAC,IAAI,IAAI;IACnC,EAAE,OAAO,GAAQ;QACf,OAAO,oKAAY,CAAC,IAAI,CAAC;YAAE,OAAO,EAAE,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IAC/D;AACF;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,QAAQ;QAE/B,MAAM,iBAAiB,OAAO,KAAK,GAAG,CAAC,sBAAsB,IAAI,IAAI;QACrE,MAAM,cAAc,OAAO,KAAK,GAAG,CAAC,kBAAkB,IAAI,IAAI;QAC9D,MAAM,OAAO,KAAK,GAAG,CAAC;QAEtB,IAAI,CAAC,kBAAkB,CAAC,eAAe,CAAC,CAAC,gBAAgB,IAAI,GAAG;YAC9D,OAAO,oKAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAgB,GAAG;gBAAE,QAAQ;YAAI;QACrE;QAEA,MAAM,aAAa,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,UAAU;QACtD,MAAM,IAAA,8HAAK,EAAC,YAAY;YAAE,WAAW;QAAK;QAE1C,MAAM,WAAW,CAAC,KAAK,IAAI,IAAI,QAAQ,EACpC,OAAO,CAAC,QAAQ,KAChB,OAAO,CAAC,oBAAoB;QAE/B,MAAM,WAAW,GAAG,KAAK,GAAG,GAAG,CAAC,EAAE,UAAU;QAC5C,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,YAAY;QAEvC,MAAM,SAAS,OAAO,IAAI,CAAC,MAAM,KAAK,WAAW;QACjD,MAAM,IAAA,kIAAS,EAAC,UAAU;QAE1B,MAAM,MAAM,CAAC,SAAS,EAAE,UAAU;QAElC,MAAM,SAAS,MAAM,KAAK,KAAK,CAC7B,CAAC;;kBAEW,CAAC,EACb;YAAC;YAAgB;YAAa;SAAI;QAGpC,OAAO,oKAAY,CAAC,IAAI,CAAC,OAAO,IAAI,CAAC,EAAE;IACzC,EAAE,OAAO,GAAQ;QACf,OAAO,oKAAY,CAAC,IAAI,CAAC;YAAE,OAAO,EAAE,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IAC/D;AACF"}}]
}