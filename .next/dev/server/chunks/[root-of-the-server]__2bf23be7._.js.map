{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/adlan/multas/multas/lib/db.ts"],"sourcesContent":["import { Pool } from \"pg\";\r\n\r\nconst pool = new Pool({\r\n  connectionString: process.env.DATABASE_URL,\r\n});\r\n\r\nexport async function query(text: string, params?: any[]) {\r\n  return pool.query(text, params);\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;;;;;AAEA,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;AAC5C;AAEO,eAAe,MAAM,IAAY,EAAE,MAAc;IACtD,OAAO,KAAK,KAAK,CAAC,MAAM;AAC1B"}},
    {"offset": {"line": 103, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/adlan/multas/multas/lib/auth.ts"],"sourcesContent":["import jwt from \"jsonwebtoken\";\r\nimport bcrypt from \"bcryptjs\";\r\n\r\nexport async function comparePassword(password: string, hash: string) {\r\n  return bcrypt.compare(password, hash);\r\n}\r\n\r\nexport function signToken(payload: any) {\r\n  return jwt.sign(payload, process.env.JWT_SECRET as string, {\r\n    expiresIn: \"1d\",\r\n  });\r\n}\r\n\r\nexport function verifyToken(token: string) {\r\n  try {\r\n    return jwt.verify(token, process.env.JWT_SECRET as string);\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;AAEO,eAAe,gBAAgB,QAAgB,EAAE,IAAY;IAClE,OAAO,kKAAM,CAAC,OAAO,CAAC,UAAU;AAClC;AAEO,SAAS,UAAU,OAAY;IACpC,OAAO,sKAAG,CAAC,IAAI,CAAC,SAAS,QAAQ,GAAG,CAAC,UAAU,EAAY;QACzD,WAAW;IACb;AACF;AAEO,SAAS,YAAY,KAAa;IACvC,IAAI;QACF,OAAO,sKAAG,CAAC,MAAM,CAAC,OAAO,QAAQ,GAAG,CAAC,UAAU;IACjD,EAAE,OAAM;QACN,OAAO;IACT;AACF"}},
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/adlan/multas/multas/app/api/login/route.ts"],"sourcesContent":["// new/multas/app/api/login/route.ts\r\nimport { NextRequest, NextResponse } from \"next/server\";\r\nimport { query } from \"@/lib/db\";\r\nimport { comparePassword, signToken } from \"@/lib/auth\";\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const { username, password } = await req.json();\r\n\r\n    if (!username || !password) {\r\n      return NextResponse.json(\r\n        { error: \"Faltan campos obligatorios\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const result = await query(\r\n      \"SELECT username, password, role FROM users WHERE username = $1\",\r\n      [username]\r\n    );\r\n\r\n    if (result.rows.length === 0) {\r\n      return NextResponse.json(\r\n        { error: \"Usuario no encontrado\" },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    const user = result.rows[0];\r\n\r\n    const isValid = await comparePassword(password, user.password);\r\n    if (!isValid) {\r\n      return NextResponse.json(\r\n        { error: \"Contrase√±a incorrecta\" },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const token = signToken({\r\n      username: user.username,\r\n      role: user.role,\r\n    });\r\n\r\n    const res = NextResponse.json({\r\n      ok: true,\r\n      user: {\r\n        username: user.username,\r\n        role: user.role,\r\n      },\r\n    });\r\n\r\n    // COOKIE JWT\r\n    res.cookies.set(\"token\", token, {\r\n      httpOnly: true,\r\n      secure: process.env.NODE_ENV === \"production\",\r\n      sameSite: \"strict\",\r\n      path: \"/\",\r\n      maxAge: 60 * 60 * 24, // 24 horas\r\n    });\r\n\r\n    return res;\r\n  } catch (error) {\r\n    console.error(\"LOGIN ERROR:\", error);\r\n    return NextResponse.json(\r\n      { error: \"Error interno del servidor\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,oCAAoC;;;;;AACpC;AACA;AACA;;;;;;;;AAEO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG,MAAM,IAAI,IAAI;QAE7C,IAAI,CAAC,YAAY,CAAC,UAAU;YAC1B,OAAO,oKAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA6B,GACtC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,SAAS,MAAM,IAAA,wIAAK,EACxB,kEACA;YAAC;SAAS;QAGZ,IAAI,OAAO,IAAI,CAAC,MAAM,KAAK,GAAG;YAC5B,OAAO,oKAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAwB,GACjC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,OAAO,OAAO,IAAI,CAAC,EAAE;QAE3B,MAAM,UAAU,MAAM,IAAA,oJAAe,EAAC,UAAU,KAAK,QAAQ;QAC7D,IAAI,CAAC,SAAS;YACZ,OAAO,oKAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAwB,GACjC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,QAAQ,IAAA,8IAAS,EAAC;YACtB,UAAU,KAAK,QAAQ;YACvB,MAAM,KAAK,IAAI;QACjB;QAEA,MAAM,MAAM,oKAAY,CAAC,IAAI,CAAC;YAC5B,IAAI;YACJ,MAAM;gBACJ,UAAU,KAAK,QAAQ;gBACvB,MAAM,KAAK,IAAI;YACjB;QACF;QAEA,aAAa;QACb,IAAI,OAAO,CAAC,GAAG,CAAC,SAAS,OAAO;YAC9B,UAAU;YACV,QAAQ,oDAAyB;YACjC,UAAU;YACV,MAAM;YACN,QAAQ,KAAK,KAAK;QACpB;QAEA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gBAAgB;QAC9B,OAAO,oKAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA6B,GACtC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}