{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/adlan/multas/multas/lib/db.ts"],"sourcesContent":["import {\r\n  Pool,\r\n  PoolClient,\r\n  QueryResult,\r\n  QueryResultRow,\r\n} from \"pg\";\r\n\r\ndeclare global {\r\n  // eslint-disable-next-line no-var\r\n  var pgPool: Pool | undefined;\r\n}\r\n\r\nif (!process.env.DATABASE_URL) {\r\n  throw new Error(\"DATABASE_URL is not defined\");\r\n}\r\n\r\nconst pool =\r\n  global.pgPool ??\r\n  new Pool({\r\n    connectionString: process.env.DATABASE_URL,\r\n    max: 5,\r\n  });\r\n\r\nif (process.env.NODE_ENV !== \"production\") {\r\n  global.pgPool = pool;\r\n}\r\n\r\nexport const query = <T extends QueryResultRow = any>(\r\n  text: string,\r\n  params?: any[]\r\n): Promise<QueryResult<T>> => pool.query(text, params);\r\n\r\nexport const getClient = (): Promise<PoolClient> => pool.connect();\r\n\r\nexport const poolInstance = pool;\r\n"],"names":[],"mappings":";;;;;;;;AAAA;;;;;;AAYA,IAAI,CAAC,QAAQ,GAAG,CAAC,YAAY,EAAE;IAC7B,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,OACJ,OAAO,MAAM,IACb,IAAI,4GAAI,CAAC;IACP,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK;AACP;AAEF,wCAA2C;IACzC,OAAO,MAAM,GAAG;AAClB;AAEO,MAAM,QAAQ,CACnB,MACA,SAC4B,KAAK,KAAK,CAAC,MAAM;AAExC,MAAM,YAAY,IAA2B,KAAK,OAAO;AAEzD,MAAM,eAAe"}},
    {"offset": {"line": 114, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/adlan/multas/multas/lib/auth.ts"],"sourcesContent":["import jwt from \"jsonwebtoken\";\r\nimport bcrypt from \"bcryptjs\";\r\n\r\nexport async function comparePassword(password: string, hash: string) {\r\n  return bcrypt.compare(password, hash);\r\n}\r\n\r\nexport function signToken(payload: any) {\r\n  return jwt.sign(payload, process.env.JWT_SECRET as string, {\r\n    expiresIn: \"1d\",\r\n  });\r\n}\r\n\r\nexport function verifyToken(token: string) {\r\n  try {\r\n    return jwt.verify(token, process.env.JWT_SECRET as string);\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;AAEO,eAAe,gBAAgB,QAAgB,EAAE,IAAY;IAClE,OAAO,kKAAM,CAAC,OAAO,CAAC,UAAU;AAClC;AAEO,SAAS,UAAU,OAAY;IACpC,OAAO,sKAAG,CAAC,IAAI,CAAC,SAAS,QAAQ,GAAG,CAAC,UAAU,EAAY;QACzD,WAAW;IACb;AACF;AAEO,SAAS,YAAY,KAAa;IACvC,IAAI;QACF,OAAO,sKAAG,CAAC,MAAM,CAAC,OAAO,QAAQ,GAAG,CAAC,UAAU;IACjD,EAAE,OAAM;QACN,OAAO;IACT;AACF"}},
    {"offset": {"line": 147, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/adlan/multas/multas/app/api/login/route.ts"],"sourcesContent":["// new/multas/app/api/login/route.ts\r\nexport const runtime = \"nodejs\";\r\n\r\nimport { NextRequest, NextResponse } from \"next/server\";\r\nimport { query } from \"@/lib/db\";\r\nimport { comparePassword, signToken } from \"@/lib/auth\";\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const { username, password } = await req.json();\r\n\r\n    if (!username || !password) {\r\n      return NextResponse.json(\r\n        { error: \"Faltan campos obligatorios\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const result = await query(\r\n      \"SELECT username, password, role FROM users WHERE username = $1\",\r\n      [username]\r\n    );\r\n\r\n    if (result.rows.length === 0) {\r\n      return NextResponse.json(\r\n        { error: \"Usuario no encontrado\" },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    const user = result.rows[0];\r\n\r\n    const isValid = await comparePassword(password, user.password);\r\n    if (!isValid) {\r\n      return NextResponse.json(\r\n        { error: \"Contrase√±a incorrecta\" },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    const token = signToken({\r\n      username: user.username,\r\n      role: user.role,\r\n    });\r\n\r\n    const res = NextResponse.json({\r\n      ok: true,\r\n      user: {\r\n        username: user.username,\r\n        role: user.role,\r\n      },\r\n    });\r\n\r\n    res.cookies.set(\"token\", token, {\r\n      httpOnly: true,\r\n      secure: process.env.NODE_ENV === \"production\",\r\n      sameSite: \"strict\",\r\n      path: \"/\",\r\n      maxAge: 60 * 60 * 24,\r\n    });\r\n\r\n    return res;\r\n  } catch (error) {\r\n    console.error(\"LOGIN ERROR:\", error);\r\n    return NextResponse.json(\r\n      { error: \"Error interno del servidor\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,oCAAoC;;;;;;;AAGpC;AACA;AACA;;;;;AAJO,MAAM,UAAU;;;;AAMhB,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG,MAAM,IAAI,IAAI;QAE7C,IAAI,CAAC,YAAY,CAAC,UAAU;YAC1B,OAAO,oKAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA6B,GACtC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,SAAS,MAAM,IAAA,wIAAK,EACxB,kEACA;YAAC;SAAS;QAGZ,IAAI,OAAO,IAAI,CAAC,MAAM,KAAK,GAAG;YAC5B,OAAO,oKAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAwB,GACjC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,OAAO,OAAO,IAAI,CAAC,EAAE;QAE3B,MAAM,UAAU,MAAM,IAAA,oJAAe,EAAC,UAAU,KAAK,QAAQ;QAC7D,IAAI,CAAC,SAAS;YACZ,OAAO,oKAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAwB,GACjC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,QAAQ,IAAA,8IAAS,EAAC;YACtB,UAAU,KAAK,QAAQ;YACvB,MAAM,KAAK,IAAI;QACjB;QAEA,MAAM,MAAM,oKAAY,CAAC,IAAI,CAAC;YAC5B,IAAI;YACJ,MAAM;gBACJ,UAAU,KAAK,QAAQ;gBACvB,MAAM,KAAK,IAAI;YACjB;QACF;QAEA,IAAI,OAAO,CAAC,GAAG,CAAC,SAAS,OAAO;YAC9B,UAAU;YACV,QAAQ,oDAAyB;YACjC,UAAU;YACV,MAAM;YACN,QAAQ,KAAK,KAAK;QACpB;QAEA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gBAAgB;QAC9B,OAAO,oKAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA6B,GACtC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}