{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/adlan/multas/multas/lib/checkSession.ts"],"sourcesContent":["// lib/checkSession.ts\r\nimport { cookies } from \"next/headers\";\r\nimport jwt from \"jsonwebtoken\";\r\n\r\ntype Session = { username?: string; role?: string; [k: string]: any } | null;\r\n\r\nexport async function getSession(): Promise<Session> {\r\n  const cookieStore = await cookies();\r\n  const token = cookieStore.get(\"token\")?.value;\r\n\r\n  if (!token) return null;\r\n\r\n  try {\r\n    const decoded = jwt.verify(token, process.env.JWT_SECRET || \"dev-secret\") as Record<string, any>;\r\n\r\n    // normalize: some tokens might use 'rol' or 'role'\r\n    const roleFromToken = decoded.role ?? decoded.rol ?? null;\r\n\r\n    const session: Session = {\r\n      ...decoded,\r\n      role: typeof roleFromToken === \"string\" ? roleFromToken.trim() : roleFromToken,\r\n    };\r\n\r\n    return session;\r\n  } catch (err) {\r\n    // token inv√°lido/expirado\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * requireRole(session, roles)\r\n * - session: el objeto devuelto por getSession()\r\n * - roles: array de roles permitidos, por ejemplo ['admin','asesor']\r\n *\r\n * Normaliza may√∫sculas/min√∫sculas y espacios.\r\n */\r\nexport function requireRole(session: Session, roles: string[] = []): boolean {\r\n  if (!session) return false;\r\n  const role = (session.role as string) ?? \"\";\r\n  const normalized = role.toString().trim().toLowerCase();\r\n  return roles.some((r) => r.toString().trim().toLowerCase() === normalized);\r\n}\r\n"],"names":[],"mappings":"AAAA,sBAAsB;;;;;;;AACtB;AACA;;;AAIO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,8JAAO;IACjC,MAAM,QAAQ,YAAY,GAAG,CAAC,UAAU;IAExC,IAAI,CAAC,OAAO,OAAO;IAEnB,IAAI;QACF,MAAM,UAAU,oKAAG,CAAC,MAAM,CAAC,OAAO,QAAQ,GAAG,CAAC,UAAU,IAAI;QAE5D,mDAAmD;QACnD,MAAM,gBAAgB,QAAQ,IAAI,IAAI,QAAQ,GAAG,IAAI;QAErD,MAAM,UAAmB;YACvB,GAAG,OAAO;YACV,MAAM,OAAO,kBAAkB,WAAW,cAAc,IAAI,KAAK;QACnE;QAEA,OAAO;IACT,EAAE,OAAO,KAAK;QACZ,0BAA0B;QAC1B,OAAO;IACT;AACF;AASO,SAAS,YAAY,OAAgB,EAAE,QAAkB,EAAE;IAChE,IAAI,CAAC,SAAS,OAAO;IACrB,MAAM,OAAO,AAAC,QAAQ,IAAI,IAAe;IACzC,MAAM,aAAa,KAAK,QAAQ,GAAG,IAAI,GAAG,WAAW;IACrD,OAAO,MAAM,IAAI,CAAC,CAAC,IAAM,EAAE,QAAQ,GAAG,IAAI,GAAG,WAAW,OAAO;AACjE"}},
    {"offset": {"line": 61, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/adlan/multas/multas/app/asesor/dashboard/layout.tsx"],"sourcesContent":["import { redirect } from \"next/navigation\";\r\nimport { getSession, requireRole } from \"@/lib/checkSession\";\r\nimport AsesorSidebar from \"@/app/asesor/components/AsesorSidebar\";\r\n\r\nexport default async function AsesorProtectedLayout({\r\n  children,\r\n}: {\r\n  children: React.ReactNode;\r\n}) {\r\n  const session = await getSession();\r\n\r\n  // üîê Si no hay sesi√≥n => login asesor\r\n  if (!session) redirect(\"/asesor\");\r\n\r\n  // üîê Requiere rol asesor\r\n  if (!requireRole(session, [\"asesor\"])) redirect(\"/403\");\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gradient-to-b from-slate-50 via-sky-50/60 to-slate-100 text-slate-900\">\r\n      <AsesorSidebar />\r\n\r\n      {/* Espacio fijo para sidebar */}\r\n      <main className=\"min-h-screen\" style={{ paddingLeft: 280 }}>\r\n        {children}\r\n      </main>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;AAAA;AACA;;;;;;;;;;AAGe,eAAe,sBAAsB,EAClD,QAAQ,EAGT;IACC,MAAM,UAAU,MAAM,IAAA,qJAAU;IAEhC,sCAAsC;IACtC,IAAI,CAAC,SAAS,IAAA,qNAAQ,EAAC;IAEvB,yBAAyB;IACzB,IAAI,CAAC,IAAA,sJAAW,EAAC,SAAS;QAAC;KAAS,GAAG,IAAA,qNAAQ,EAAC;IAEhD,qBACE,kQAAC;QAAI,WAAU;;0BACb,kQAAC;;;;;0BAGD,kQAAC;gBAAK,WAAU;gBAAe,OAAO;oBAAE,aAAa;gBAAI;0BACtD;;;;;;;;;;;;AAIT"}}]
}