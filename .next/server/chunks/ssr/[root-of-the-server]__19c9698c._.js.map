{"version":3,"sources":["../../../../../../multas/multas/lib/db.ts","../../../../../../multas/multas/app/enlace-temporal/%5Btoken%5D/page.tsx"],"sourcesContent":["import {\r\n  Pool,\r\n  PoolClient,\r\n  QueryResult,\r\n  QueryResultRow,\r\n} from \"pg\";\r\n\r\ndeclare global {\r\n  // eslint-disable-next-line no-var\r\n  var pgPool: Pool | undefined;\r\n}\r\n\r\nconst pool =\r\n  global.pgPool ??\r\n  new Pool({\r\n    connectionString: process.env.DATABASE_URL,\r\n    ssl: { rejectUnauthorized: false },\r\n    max: 5,\r\n  });\r\n\r\nif (process.env.NODE_ENV !== \"production\") {\r\n  global.pgPool = pool;\r\n}\r\n\r\nexport const query = <T extends QueryResultRow = any>(\r\n  text: string,\r\n  params?: any[]\r\n): Promise<QueryResult<T>> => {\r\n  return pool.query(text, params);\r\n};\r\n\r\nexport const getClient = (): Promise<PoolClient> => {\r\n  return pool.connect();\r\n};\r\n\r\nexport const poolInstance = pool;\r\n","// app/plantilla/[token]/page.tsx\r\nimport { notFound } from \"next/navigation\";\r\nimport { query } from \"@/lib/db\";\r\nimport React from \"react\";\r\n\r\nexport const runtime = \"nodejs\";\r\n\r\n// Función para formatear fecha\r\nconst formatDateReadable = (iso: string | null) => {\r\n  if (!iso) return \"—\";\r\n  try {\r\n    return new Date(iso + \"T00:00:00\").toLocaleDateString(undefined, {\r\n      day: \"2-digit\",\r\n      month: \"long\",\r\n      year: \"numeric\",\r\n    });\r\n  } catch {\r\n    return iso;\r\n  }\r\n};\r\n\r\n// Props\r\ntype Props = {\r\n  params: {\r\n    token: string;\r\n  };\r\n};\r\n\r\nexport default async function PlantillaPage({ params }: Props) {\r\n  const { token } = params;\r\n\r\n  // Buscar plantilla en la BD\r\n  const res = await query(\r\n    `SELECT * FROM plantillas_temporales WHERE token = $1`,\r\n    [token]\r\n  );\r\n\r\n  if (res.rowCount === 0) {\r\n    notFound();\r\n  }\r\n\r\n  const plantilla = res.rows[0];\r\n\r\n  // Verificar expiración\r\n  if (\r\n    plantilla.expires_at &&\r\n    new Date(plantilla.expires_at) < new Date()\r\n  ) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-screen\">\r\n        <p className=\"text-red-500 text-lg font-bold\">\r\n          Esta plantilla ha expirado.\r\n        </p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"w-full min-h-screen flex items-center justify-center p-6 bg-[#152032]\">\r\n      <div\r\n        className=\"w-[420px] rounded-2xl overflow-hidden shadow-[0_20px_40px_rgba(0,0,0,0.45)]\"\r\n        style={{ backgroundColor: plantilla.card_bg_color }}\r\n      >\r\n        {/* HEADER */}\r\n        <div\r\n          className=\"w-full h-[160px] flex flex-col items-center pt-6\"\r\n          style={{\r\n            background:\r\n              \"linear-gradient(180deg,#5CB0FF 0%,#A3D4FF 100%)\",\r\n          }}\r\n        >\r\n          <div className=\"w-16 h-16 bg-white rounded-xl flex items-center justify-center overflow-hidden shadow\">\r\n            {plantilla.logo_url ? (\r\n              <img\r\n                src={plantilla.logo_url}\r\n                className=\"w-full h-full object-cover\"\r\n                alt=\"logo\"\r\n              />\r\n            ) : (\r\n              <span className=\"text-lg font-bold text-[#142546]\">\r\n                IMG\r\n              </span>\r\n            )}\r\n          </div>\r\n\r\n          <h2 className=\"text-lg font-bold text-[#142546] mt-4\">\r\n            {plantilla.producto}\r\n          </h2>\r\n        </div>\r\n\r\n        {/* MONTO */}\r\n        <div\r\n          className=\"mx-4 -mt-4 rounded-xl p-4 text-white shadow-md\"\r\n          style={{ backgroundColor: plantilla.primary_color }}\r\n        >\r\n          <div className=\"text-xs opacity-90\">\r\n            Monto de Préstamo\r\n          </div>\r\n          <div className=\"text-3xl font-bold\">\r\n            {plantilla.monto}\r\n          </div>\r\n        </div>\r\n\r\n        {/* DETALLES */}\r\n        <div className=\"px-4 py-5 flex flex-col gap-4\">\r\n          <div\r\n            className=\"rounded-xl border p-3 shadow-sm\"\r\n            style={{ backgroundColor: plantilla.card_bg_color }}\r\n          >\r\n            <div className=\"flex justify-between items-center py-3 border-b\">\r\n              <span className=\"text-sm font-medium text-gray-700\">\r\n                Producto\r\n              </span>\r\n              <span className=\"text-sm text-gray-600\">\r\n                {plantilla.producto}\r\n              </span>\r\n            </div>\r\n\r\n            <div className=\"flex justify-between items-center py-3 border-b\">\r\n              <span className=\"text-sm font-medium text-gray-700\">\r\n                Importe a Pagar\r\n              </span>\r\n              <span className=\"text-gray-500\">\r\n                {plantilla.importe_pagar}\r\n              </span>\r\n            </div>\r\n\r\n            <div className=\"flex justify-between items-center py-3 border-b\">\r\n              <span className=\"text-sm font-medium text-gray-700\">\r\n                Fecha Vencimiento\r\n              </span>\r\n              <span className=\"text-sm text-gray-600\">\r\n                {formatDateReadable(\r\n                  plantilla.fecha_vencimiento\r\n                )}\r\n              </span>\r\n            </div>\r\n\r\n            <div className=\"flex justify-between items-center py-3\">\r\n              <span className=\"text-sm font-medium text-gray-700\">\r\n                Días vencimiento\r\n              </span>\r\n              <span className=\"text-sm text-gray-500\">\r\n                {plantilla.dias_vencidos} días\r\n              </span>\r\n            </div>\r\n          </div>\r\n\r\n          {/* MÉTODO DE PAGO */}\r\n          <div\r\n            className=\"rounded-xl p-3 shadow-sm\"\r\n            style={{ backgroundColor: plantilla.card_bg_color }}\r\n          >\r\n            <div className=\"text-sm font-medium text-gray-700 mb-2\">\r\n              Método de pago\r\n            </div>\r\n\r\n            <div className=\"flex items-center justify-center bg-[#F8FAFB] p-4 rounded-md\">\r\n              <div className=\"text-center\">\r\n                <div className=\"text-xs text-gray-500\">\r\n                  SPEI\r\n                </div>\r\n                <div className=\"text-lg md:text-xl lg:text-2xl font-extrabold text-gray-700 mt-1\">\r\n                  {plantilla.cuenta_bancaria}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          {/* EXTRAS */}\r\n          {plantilla.mostrar_extras && (\r\n            <div\r\n              className=\"rounded-xl p-3 shadow-sm\"\r\n              style={{ backgroundColor: plantilla.card_bg_color }}\r\n            >\r\n              <div className=\"flex justify-between items-center py-2 border-b\">\r\n                <span className=\"text-sm font-medium text-gray-700\">\r\n                  Nombre\r\n                </span>\r\n                <span className=\"text-sm text-gray-600\">\r\n                  {plantilla.nombre_cliente}\r\n                </span>\r\n              </div>\r\n\r\n              <div className=\"flex justify-between items-center py-2\">\r\n                <span className=\"text-sm font-medium text-gray-700\">\r\n                  Teléfono\r\n                </span>\r\n                <span className=\"text-sm text-gray-600\">\r\n                  {plantilla.telefono_cliente}\r\n                </span>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"8ZAAA,IAAA,EAAA,EAAA,CAAA,CAAA,yCAYA,IAAM,EACJ,OAAO,MAAM,EACb,IAAI,EAAA,IAAI,CAAC,CACP,iBAAkB,QAAQ,GAAG,CAAC,YAAY,CAC1C,IAAK,CAAE,oBAAoB,CAAM,EACjC,IAAK,CACP,kBAMmB,CACnB,EACA,IAEO,EAAK,KAAK,CAAC,EAAM,4EC3B1B,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,gBA0Be,eAAe,EAAc,CAAE,QAAM,CAAS,EAC3D,GAAM,OAAE,CAAK,CAAE,CAAG,EAGZ,EAAM,MAAM,CAAA,EAAA,EAAA,KAAA,AAAK,EACrB,CAAC,oDAAoD,CAAC,CACtD,CAAC,EAAM,EAGY,GAAG,CAApB,EAAI,QAAQ,EACd,CAAA,EAAA,EAAA,QAAA,AAAQ,IAGV,IAAM,EAAY,EAAI,IAAI,CAAC,EAAE,QAG7B,AACE,EAAU,UAAU,EACpB,IAAI,KAAK,EAAU,UAAU,EAAI,IAAI,KAGnC,CAAA,EAFF,AAEE,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,yDACb,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,0CAAiC,kCAQlD,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,iFACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CACC,UAAU,8EACV,MAAO,CAAE,gBAAiB,EAAU,aAAa,AAAC,YAGlD,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CACC,UAAU,mDACV,MAAO,CACL,WACE,iDACJ,YAEA,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,iGACZ,EAAU,QAAQ,CACjB,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CACC,IAAK,EAAU,QAAQ,CACvB,UAAU,6BACV,IAAI,SAGN,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,4CAAmC,UAMvD,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,iDACX,EAAU,QAAQ,MAKvB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CACC,UAAU,iDACV,MAAO,CAAE,gBAAiB,EAAU,aAAa,AAAC,YAElD,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,8BAAqB,sBAGpC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,8BACZ,EAAU,KAAK,MAKpB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,0CACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CACC,UAAU,kCACV,MAAO,CAAE,gBAAiB,EAAU,aAAa,AAAC,YAElD,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,4DACb,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,6CAAoC,aAGpD,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,iCACb,EAAU,QAAQ,MAIvB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,4DACb,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,6CAAoC,oBAGpD,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,yBACb,EAAU,aAAa,MAI5B,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,4DACb,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,6CAAoC,sBAGpD,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,iCACb,CA5HU,AAAC,IAC1B,GAAI,CAAC,EAAK,MAAO,IACjB,GAAI,CACF,OAAO,IAAI,KAAK,EAAM,aAAa,kBAAkB,MAAC,EAAW,CAC/D,IAAK,UACL,MAAO,OACP,KAAM,SACR,EACF,CAAE,KAAM,CACN,OAAO,CACT,EACF,EAkHkB,EAAU,iBAAiB,OAKjC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,mDACb,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,6CAAoC,qBAGpD,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,UAAU,kCACb,EAAU,aAAa,CAAC,iBAM/B,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CACC,UAAU,2BACV,MAAO,CAAE,gBAAiB,EAAU,aAAa,AAAC,YAElD,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,kDAAyC,mBAIxD,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,wEACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,wBACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,iCAAwB,SAGvC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,4EACZ,EAAU,eAAe,WAOjC,EAAU,cAAc,EACvB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CACC,UAAU,2BACV,MAAO,CAAE,gBAAiB,EAAU,aAAa,AAAC,YAElD,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,4DACb,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,6CAAoC,WAGpD,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,iCACb,EAAU,cAAc,MAI7B,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,mDACb,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,6CAAoC,aAGpD,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,iCACb,EAAU,gBAAgB,gBAS7C,2DAjMuB"}