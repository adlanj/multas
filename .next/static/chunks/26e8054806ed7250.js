(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,46674,(e,t,a)=>{t.exports=e.r(31408)},10969,e=>{"use strict";var t=e.i(17386),a=e.i(2439),l=e.i(46674);function s({data:e={}}){let s=e=>/^#([0-9A-Fa-f]{6})$/.test(String(e||"")),r=window.location.origin,n=(0,l.useParams)(),i=n?.id?String(n.id):null,o=e.plantilla_pago_id??e.plantillas_pago_id??e.plantilla_id??e.id_plantilla??e.plantillaPagoId??e.plantillaId??e.id??null,d=i??(o?String(o):null),[c,u]=(0,a.useState)(null),[m,x]=(0,a.useState)(!0),[p,g]=(0,a.useState)("");(0,a.useEffect)(()=>{let e=!1;return async function(){x(!0),g("");try{let t=d?`/api/plantillas/${encodeURIComponent(d)}`:"/api/plantilla-pago",a=await fetch(t,{cache:"no-store"}),l=await a.json().catch(()=>({}));if(!a.ok)throw Error(l?.error||"No se pudo cargar la plantilla");let s=l?.data??l;e||u(s)}catch(t){console.error("❌ Error cargando plantilla:",t),e||(u(null),g(t?.message||"Error cargando plantilla"))}finally{e||x(!1)}}(),()=>{e=!0}},[d]);let b=(0,a.useMemo)(()=>((e={},t={})=>{let a={...e};for(let[e,l]of Object.entries(t||{}))null!=l&&""!==l&&(a[e]=l);return a})(c??{},e??{}),[c,e]),h=b?.subproducto??b?.ubproducto??"",f=b?.cuenta_bancaria??"",v=b?.url??b?.logo_url??b?.imagen_url??b?.logoUrl??b?.logo??null,j=(0,a.useMemo)(()=>(e=>{if(!e)return null;let t=String(e).trim().replaceAll("\\","/");return/^https?:\/\//i.test(t)?t:(t.startsWith("public/uploads/")&&(t=t.replace("public/","")),t.startsWith("uploads/")&&(t=`/${t}`),t.startsWith("/"))?r?`${r}${t}`:t:r?`${r}/${t}`:t})(v),[v]),y=!!h&&!!f&&!!v,[N,w]=(0,a.useState)(""),[F,_]=(0,a.useState)(""),[S,C]=(0,a.useState)(!0),[k,E]=(0,a.useState)(""),[B,G]=(0,a.useState)(""),[R,T]=(0,a.useState)(""),[A,I]=(0,a.useState)(0);(0,a.useEffect)(()=>{b?.monto!=null&&""===k&&E(String(b.monto)),b?.importe_pagar!=null&&""===B&&G(String(b.importe_pagar)),b?.fecha_vencimiento&&!R&&T(String(b.fecha_vencimiento)),"number"==typeof b?.dias_vencidos&&I(b.dias_vencidos),b?.nombre_cliente&&!N&&w(String(b.nombre_cliente)),b?.telefono_cliente&&!F&&_(String(b.telefono_cliente)),"boolean"==typeof b?.mostrar_extras&&C(b.mostrar_extras)},[b]),(0,a.useEffect)(()=>{G(k)},[k]),(0,a.useEffect)(()=>{if(!R)return I(0);let e=new Date;I(Math.ceil((new Date(R+"T00:00:00").getTime()-e.getTime())/864e5))},[R]);let[M,P]=(0,a.useState)("#ffffff"),[$,D]=(0,a.useState)("#ffffff"),[O,L]=(0,a.useState)("#0F56F7"),[U,V]=(0,a.useState)("#0F56F7"),[W,z]=(0,a.useState)(""),[K,H]=(0,a.useState)("");(0,a.useEffect)(()=>{b?.card_bg_color&&s(b.card_bg_color)&&(P(String(b.card_bg_color)),D(String(b.card_bg_color))),b?.primary_color&&s(b.primary_color)&&(L(String(b.primary_color)),V(String(b.primary_color)))},[b?.card_bg_color,b?.primary_color]);let[J,q]=(0,a.useState)(!1),[Q,X]=(0,a.useState)(null);async function Y(){let e={plantilla_pago_id:d,subproducto:b.subproducto??b.ubproducto,cuenta_bancaria:b.cuenta_bancaria,url:j,monto:k,importe_pagar:B,fecha_vencimiento:R||null,dias_vencidos:A,nombre_cliente:N,telefono_cliente:F,mostrar_extras:S,card_bg_color:M,primary_color:O,locked:!0},t=await fetch("/api/plantillas-temporales",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await t.json().catch(()=>({}));if(!t.ok)throw Error(a?.error||"No se pudo generar el link");return String(a.link)}let Z=async()=>{if(!J){q(!0);try{let e=await Y();X(e),window.location.href=e}catch(e){alert(e?.message||"Error generando link")}finally{q(!1)}}};return!m&&(y||p)?p&&!y?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-[#152032] text-white p-6",children:(0,t.jsxs)("div",{className:"max-w-md",children:[(0,t.jsx)("div",{className:"text-xl font-bold mb-2",children:"No se pudo cargar la plantilla"}),(0,t.jsx)("div",{className:"text-sm opacity-90",children:p})]})}):(0,t.jsxs)("div",{className:"w-full min-h-screen flex items-center justify-center p-6 relative bg-[#152032]",children:[(0,t.jsxs)("div",{className:"absolute right-6 top-16 z-50 flex flex-col gap-4 w-60",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between text-white",children:[(0,t.jsx)("span",{className:"text-sm font-medium",children:"Mostrar datos del cliente"}),(0,t.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,t.jsx)("input",{type:"checkbox",checked:S,onChange:()=>C(!S),className:"sr-only peer",disabled:J}),(0,t.jsx)("div",{className:"w-11 h-6 bg-gray-300 peer-checked:bg-blue-600 rounded-full relative   after:content-[''] after:w-5 after:h-5 after:bg-white after:rounded-full   after:absolute after:left-1 after:top-0.5 peer-checked:after:translate-x-5 transition-all"})]})]}),(0,t.jsxs)("div",{className:"bg-white/5 p-3 rounded-lg",children:[(0,t.jsx)("div",{className:"text-xs text-white mb-2 font-medium",children:"Fondo de la tarjeta"}),(0,t.jsx)("select",{className:"w-full p-2 rounded-md mb-2 text-sm",value:M,onChange:e=>{P(e.target.value),D(e.target.value),z("")},disabled:J,children:[{label:"Blanco",value:"#FFFFFF"},{label:"Gris claro",value:"#F8FAFC"},{label:"Gris suave",value:"#EEF2F6"},{label:"Marfil",value:"#FFF4E6"},{label:"Crema",value:"#FFF7ED"},{label:"Very Light Blue",value:"#F0F9FF"},{label:"Lavanda",value:"#F5F3FF"},{label:"Rosa claro",value:"#FFF1F2"},{label:"Verde suave",value:"#ECFDF5"},{label:"Amarillo suave",value:"#FFFBEB"},{label:"Gris perla",value:"#F1F5F9"},{label:"Humo",value:"#F3F4F6"}].map(e=>(0,t.jsxs)("option",{value:e.value,children:[e.label," — ",e.value]},e.value))}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("input",{type:"text",value:$,onChange:e=>{var t;D(t=e.target.value),s(t)?(P(t),z("")):z("Ingresa color en formato #RRGGBB")},className:"flex-1 p-2 rounded-md text-sm",placeholder:"#RRGGBB",disabled:J}),(0,t.jsx)("div",{className:"w-10 h-10 rounded-md border",style:{backgroundColor:s($)?$:M}})]}),W&&(0,t.jsx)("div",{className:"text-xs text-rose-400 mt-1",children:W})]}),(0,t.jsxs)("div",{className:"bg-white/5 p-3 rounded-lg",children:[(0,t.jsx)("div",{className:"text-xs text-white mb-2 font-medium",children:"Color del botón / burbuja"}),(0,t.jsx)("select",{className:"w-full p-2 rounded-md mb-2 text-sm",value:O,onChange:e=>{L(e.target.value),V(e.target.value),H("")},disabled:J,children:[{label:"Azul (default)",value:"#0F56F7"},{label:"Naranja",value:"#FF6B00"},{label:"Verde",value:"#10B981"},{label:"Rojo",value:"#EF4444"},{label:"Morado",value:"#7C3AED"},{label:"Teal",value:"#06B6D4"},{label:"Indigo",value:"#4F46E5"},{label:"Cian",value:"#0891B2"},{label:"Rosa fuerte",value:"#EC4899"},{label:"Amarillo",value:"#F59E0B"},{label:"Gris oscuro",value:"#374151"},{label:"Negro",value:"#111827"}].map(e=>(0,t.jsxs)("option",{value:e.value,children:[e.label," — ",e.value]},e.value))}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("input",{type:"text",value:U,onChange:e=>{var t;V(t=e.target.value),s(t)?(L(t),H("")):H("Ingresa color en formato #RRGGBB")},className:"flex-1 p-2 rounded-md text-sm",placeholder:"#RRGGBB",disabled:J}),(0,t.jsx)("div",{className:"w-10 h-10 rounded-md border",style:{backgroundColor:s(U)?U:O}})]}),K&&(0,t.jsx)("div",{className:"text-xs text-rose-400 mt-1",children:K})]}),Q&&(0,t.jsxs)("div",{className:"bg-white/5 p-3 rounded-lg",children:[(0,t.jsx)("div",{className:"text-xs text-white mb-2 font-medium",children:"Link generado"}),(0,t.jsx)("input",{className:"w-full p-2 rounded-md text-sm",value:Q,readOnly:!0}),(0,t.jsx)("button",{className:"mt-2 w-full p-2 rounded-md text-sm bg-white/10 hover:bg-white/20 text-white",onClick:()=>navigator.clipboard.writeText(Q),type:"button",children:"Copiar link"})]})]}),(0,t.jsxs)("div",{className:"w-[420px] rounded-2xl overflow-hidden shadow-[0_20px_40px_rgba(0,0,0,0.45)]",style:{backgroundColor:M},children:[(0,t.jsxs)("div",{className:"w-full h-[160px] flex flex-col items-center pt-6",style:{background:"linear-gradient(180deg,#5CB0FF 0%,#A3D4FF 100%)"},children:[(0,t.jsx)("div",{className:"w-16 h-16 bg-white rounded-xl flex items-center justify-center overflow-hidden shadow",children:j?(0,t.jsx)("img",{src:j,className:"w-full h-full object-cover",alt:"logo",crossOrigin:"anonymous",onError:()=>console.log("❌ NO carga IMG:",j)}):(0,t.jsx)("span",{className:"text-lg font-bold text-[#142546]",children:"IMG"})}),(0,t.jsx)("h2",{className:"text-lg font-bold text-[#142546] mt-4",children:h})]}),(0,t.jsxs)("div",{className:"mx-4 -mt-4 rounded-xl p-4 text-white shadow-md",style:{backgroundColor:O},children:[(0,t.jsx)("div",{className:"text-xs opacity-90",children:"Monto de Préstamo"}),(0,t.jsx)("input",{type:"text",value:k,onChange:e=>E(e.target.value),placeholder:"$0.00",className:"w-full bg-transparent text-3xl font-bold outline-none",disabled:J})]}),(0,t.jsxs)("div",{className:"px-4 py-5 flex flex-col gap-4",children:[(0,t.jsxs)("div",{className:"bg-transparent rounded-xl border p-3 shadow-sm",style:{backgroundColor:M},children:[(0,t.jsxs)("div",{className:"flex justify-between items-center py-3 border-b",children:[(0,t.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Producto"}),(0,t.jsx)("span",{className:"text-sm text-gray-600",children:h})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center py-3 border-b",children:[(0,t.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Importe a Pagar"}),(0,t.jsx)("input",{type:"text",value:B,onChange:e=>G(e.target.value),className:"text-gray-400 text-right w-28 bg-transparent font-semibold outline-none",disabled:J})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center py-3 border-b",children:[(0,t.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Fecha Vencimiento"}),(0,t.jsx)("input",{type:"date",value:R,onChange:e=>T(e.target.value),className:"text-gray-400 text-right bg-transparent outline-none",disabled:J})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center py-3",children:[(0,t.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Días vencimiento"}),(0,t.jsxs)("span",{className:"text-sm text-gray-500",children:[A," días"]})]})]}),(0,t.jsxs)("div",{className:"bg-transparent rounded-xl p-3 shadow-sm",style:{backgroundColor:M},children:[(0,t.jsx)("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Elige el método de pago"}),(0,t.jsx)("div",{className:"flex items-center justify-center bg-[#F8FAFB] p-4 rounded-md",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-xs text-gray-500",children:"SPEI"}),(0,t.jsx)("div",{className:"text-lg md:text-xl lg:text-2xl font-extrabold text-gray-700 mt-1",children:f})]})})]}),S&&(0,t.jsxs)("div",{className:"bg-transparent rounded-xl p-3 shadow-sm",style:{backgroundColor:M},children:[(0,t.jsxs)("div",{className:"flex justify-between items-center py-2 border-b",children:[(0,t.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Nombre"}),(0,t.jsx)("input",{className:"text-sm text-right bg-transparent outline-none text-gray-700",placeholder:"Nombre",value:N,onChange:e=>w(e.target.value),disabled:J})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center py-2",children:[(0,t.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Teléfono"}),(0,t.jsx)("input",{className:"text-sm text-right bg-transparent outline-none text-gray-700",placeholder:"Teléfono",value:F,onChange:e=>_(e.target.value),disabled:J})]})]}),(0,t.jsx)("button",{onClick:Z,className:"w-full text-white p-3 rounded-xl text-lg font-semibold mt-2 disabled:opacity-60",style:{backgroundColor:O},disabled:J,type:"button",children:J?"Generando link...":"Confirmar y Generar Link"})]})]})]}):(0,t.jsxs)("div",{className:"min-h-screen flex items-center justify-center bg-[#152032] text-white p-6",children:["Cargando plantilla ",d?`#${d}`:"","…"]})}e.s(["default",()=>s])}]);